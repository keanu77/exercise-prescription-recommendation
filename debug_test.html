<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>運動處方測試</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">運動處方系統測試</h1>
        
        <!-- 簡化表單 -->
        <div class="bg-white p-6 rounded-lg shadow mb-8">
            <h2 class="text-xl font-semibold mb-4">基本資料</h2>
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label>年齡</label>
                    <input type="number" id="age" value="30" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label>性別</label>
                    <select id="gender" class="w-full p-2 border rounded">
                        <option value="male">男</option>
                        <option value="female">女</option>
                    </select>
                </div>
                <div>
                    <label>體重(kg)</label>
                    <input type="number" id="weight" value="70" class="w-full p-2 border rounded">
                </div>
            </div>
            
            <div class="mb-4">
                <label>體能水平</label>
                <div class="flex gap-4">
                    <label><input type="radio" name="fitness_level" value="poor"> 差</label>
                    <label><input type="radio" name="fitness_level" value="fair"> 普通</label>     
                    <label><input type="radio" name="fitness_level" value="good" checked> 良好</label>
                    <label><input type="radio" name="fitness_level" value="excellent"> 優秀</label>
                </div>
            </div>
            
            <div class="mb-4">
                <label>運動習慣</label>
                <div class="flex gap-4">
                    <label><input type="radio" name="exercise_habit" value="none"> 無</label>
                    <label><input type="radio" name="exercise_habit" value="light"> 輕度</label>
                    <label><input type="radio" name="exercise_habit" value="moderate" checked> 中度</label>
                    <label><input type="radio" name="exercise_habit" value="active"> 活躍</label>
                </div>
            </div>
            
            <button onclick="testPrescription()" class="bg-blue-600 text-white px-6 py-2 rounded">
                生成運動處方
            </button>
        </div>
        
        <!-- 結果顯示 -->
        <div id="results" class="hidden">
            <div id="prescriptionSummary" class="bg-blue-50 p-6 rounded-lg mb-6"></div>
            <div id="fittpDetails" class="bg-white p-6 rounded-lg mb-6"></div>
            <div id="exerciseGuidelines" class="bg-gray-50 p-6 rounded-lg"></div>
        </div>
    </div>

    <script>
        // 嵌入必要的 JavaScript 函數
        const MET_ACTIVITIES = {
            light: [
                { name: '緩慢走路', met: 2.0, examples: ['漫步', '輕鬆散步'] },
                { name: '輕度家務', met: 2.5, examples: ['洗碗', '整理房間'] }
            ],
            moderate: [
                { name: '快走', met: 3.5, examples: ['健走', '快速步行'] },
                { name: '騎自行車', met: 4.0, examples: ['平地騎車', '休閒單車'] }
            ],
            vigorous: [
                { name: '跑步', met: 8.0, examples: ['慢跑', '中速跑步'] },
                { name: '游泳', met: 10.0, examples: ['自由式', '蝶式'] }
            ]
        };

        function calculateCalories(metValue, weightKg, durationMinutes) {
            const hours = durationMinutes / 60;
            return Math.round(metValue * weightKg * hours * 10) / 10;
        }

        function getMETActivitiesHtml(prescription) {
            const weight = parseFloat(document.getElementById('weight').value) || 70;
            const age = parseInt(document.getElementById('age').value);
            const fitnessLevel = document.querySelector('input[name="fitness_level"]:checked').value;
            
            let intensity = 'moderate';
            if (age >= 65 || fitnessLevel === 'poor') {
                intensity = 'light';
            } else if (fitnessLevel === 'excellent' && age < 50) {
                intensity = 'vigorous';
            }
            
            const activities = MET_ACTIVITIES[intensity].slice(0, 2);
            
            const activitiesHtml = activities.map(activity => {
                const calories30min = calculateCalories(activity.met, weight, 30);
                return `
                    <div class="bg-white p-3 rounded border mb-2">
                        <div class="flex justify-between">
                            <div>
                                <h6 class="font-semibold">${activity.name}</h6>
                                <p class="text-sm text-gray-600">${activity.met} METs</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-semibold text-blue-600">${calories30min} 卡路里</p>
                                <p class="text-xs text-gray-500">30分鐘</p>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            return `
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                    <h5 class="font-semibold text-yellow-800 mb-3">推薦活動</h5>
                    ${activitiesHtml}
                </div>
            `;
        }

        function getAgeGroup(age) {
            if (age >= 6 && age <= 11) return 'child';
            if (age >= 12 && age <= 17) return 'adolescent'; 
            if (age >= 18 && age <= 64) return 'adult';
            if (age >= 65) return 'senior';
            return 'unknown';
        }

        function calculateFITTVP(data) {
            const prescription = {
                frequency: 3,
                intensity: 'moderate',
                time: 30,
                type: ['有氧運動', '肌力訓練'],
                volume: 450,
                progression: '每2-4週增加10%運動時間或頻率',
                warnings: [],
                recommendations: [],
                ageGroup: getAgeGroup(data.age)
            };

            // 根據年齡調整
            if (data.age >= 18 && data.age <= 64) {
                prescription.frequency = 4;
                prescription.time = 38;
                prescription.recommendations.push('每週至少2次肌力訓練');
                
                // 根據體能水平調整
                switch (data.fitness_level) {
                    case 'poor':
                        prescription.frequency = 3;
                        prescription.time = 15;
                        prescription.intensity = 'light';
                        break;
                    case 'fair':
                        prescription.frequency = 3;
                        prescription.time = 20;
                        break;
                    case 'excellent':
                        prescription.frequency = 5;
                        prescription.time = 45;
                        break;
                }
            }

            return prescription;
        }

        function displayPrescriptionSummary(prescription) {
            const container = document.getElementById('prescriptionSummary');
            
            container.innerHTML = `
                <h3 class="text-2xl font-bold text-blue-800 mb-4">個人化運動處方</h3>
                <div class="grid grid-cols-4 gap-4">
                    <div class="bg-white rounded-lg p-4 shadow text-center">
                        <div class="text-2xl font-bold text-blue-600">每週${prescription.frequency}次</div>
                        <div class="text-sm text-gray-600">頻率</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow text-center">
                        <div class="text-2xl font-bold text-green-600">${prescription.intensity}</div>
                        <div class="text-sm text-gray-600">強度</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow text-center">
                        <div class="text-2xl font-bold text-purple-600">${prescription.time}分鐘</div>
                        <div class="text-sm text-gray-600">時間</div>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow text-center">
                        <div class="text-2xl font-bold text-orange-600">${prescription.type.join('、')}</div>
                        <div class="text-sm text-gray-600">類型</div>
                    </div>
                </div>
            `;
        }

        function displayFITTPDetails(prescription) {
            const container = document.getElementById('fittpDetails');
            const metActivitiesHtml = getMETActivitiesHtml(prescription);
            
            container.innerHTML = `
                <h4 class="text-xl font-semibold mb-4">FITT-VP 詳細說明</h4>
                ${metActivitiesHtml}
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h5 class="font-semibold mb-2">頻率 (Frequency)</h5>
                        <p>每週 ${prescription.frequency} 次運動</p>
                    </div>
                    <div>
                        <h5 class="font-semibold mb-2">強度 (Intensity)</h5>
                        <p>${prescription.intensity} 強度</p>
                    </div>
                    <div>
                        <h5 class="font-semibold mb-2">時間 (Time)</h5>
                        <p>每次 ${prescription.time} 分鐘</p>
                    </div>
                    <div>
                        <h5 class="font-semibold mb-2">類型 (Type)</h5>
                        <p>${prescription.type.join('、')}</p>
                    </div>
                </div>
            `;
        }

        function displayExerciseGuidelines(prescription) {
            const container = document.getElementById('exerciseGuidelines');
            
            let guidelinesHtml = '';
            if (prescription.recommendations.length > 0) {
                guidelinesHtml = `
                    <div class="mb-4">
                        <h5 class="font-semibold mb-2">建議事項</h5>
                        <ul class="list-disc list-inside">
                            ${prescription.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            container.innerHTML = `
                <h4 class="text-xl font-semibold mb-4">運動指導</h4>
                ${guidelinesHtml}
                <div class="bg-blue-50 p-4 rounded">
                    <h5 class="font-semibold mb-2">進展方式</h5>
                    <p>${prescription.progression}</p>
                </div>
            `;
        }

        function testPrescription() {
            try {
                const data = {
                    age: parseInt(document.getElementById('age').value),
                    gender: document.getElementById('gender').value,
                    weight: parseFloat(document.getElementById('weight').value),
                    fitness_level: document.querySelector('input[name="fitness_level"]:checked').value,
                    exercise_habit: document.querySelector('input[name="exercise_habit"]:checked').value,
                    diseases: [],
                    limitations: []
                };
                
                console.log('測試數據:', data);
                
                const prescription = calculateFITTVP(data);
                console.log('生成的處方:', prescription);
                
                displayPrescriptionSummary(prescription);
                displayFITTPDetails(prescription);
                displayExerciseGuidelines(prescription);
                
                document.getElementById('results').classList.remove('hidden');
                
                alert('運動處方生成成功！');
                
            } catch (error) {
                console.error('錯誤:', error);
                alert('生成運動處方時發生錯誤: ' + error.message);
            }
        }
    </script>
</body>
</html>